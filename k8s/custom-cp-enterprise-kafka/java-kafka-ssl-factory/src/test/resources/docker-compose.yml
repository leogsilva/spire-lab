version: '3'
services:
  spire-server:
    build: ./docker/spire-server
    hostname: spire-server
    tty: true
    privileged: true
    entrypoint: /usr/bin/dumb-init /opt/spire/bin/spire-server run
    networks:
      envoymesh:
        aliases:
          - spire-server

  spire-agent:
    build: ./docker/spire-agent
    hostname: spire-agent
    tty: true
    privileged: true
    entrypoint: tail -f /opt/spire/agent.log
    networks:
      envoymesh:
        aliases:
          - spire-agent
    volumes:
      - /tmp/bootstrap:/tmp/bootstrap
networks:
  envoymesh: {}